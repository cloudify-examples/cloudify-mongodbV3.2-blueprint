tosca_definitions_version: cloudify_dsl_1_2

description: The blueprint describes an shared mongoDB cluster.

imports:
  - types/types.yaml
  - http://www.getcloudify.org/spec/diamond-plugin/1.3.1/plugin.yaml
  - types/mongodbtypes.yaml

inputs:
  server_ip:
    description: The ip of the server the application will be deployed on.
    default: 192.168.10.238
  mongo_verion:
    description: MongoDB version to install
    default: 3.2.3
  mongod_port:
    description: Mongod process port
    default: 27017
  mongos_port:
    description: Mongos process port
    default: 27018
  mongo_config_port:
    description: Mongo config MGR process port
    default: 27019

node_templates:
  vm:
    type: cloudify.nodes.Compute
    properties:
      ip: { get_input: server_ip }
  mongod:
    type: cloudify.nodes.Mongod
    properties:
      port: { get_input: mongod_port }
    relationships:
      - type: cloudify.relationships.contained_in
        target: vm
  mongo_config:
    type: cloudify.nodes.MongoConfig
    properties:
      port: { get_input: mongo_config_port }
    relationships:
      - type: cloudify.relationships.contained_in
        target: vm
  mongos:
    type: cloudify.nodes.Mongos
    properties:
      port: { get_input: mongos_port }
    relationships:
      - type: cloudify.relationships.contained_in
        target: vm
      - type: mongos_depends_on_mongo_config
        target: mongo_config
  mongo_mgr:
    type: cloudify.nodes.MongoMGR
    relationships:
      - type: cloudify.relationships.contained_in
        target: vm
      - type: mongo_mgr_connect_mondod
        target: mongod
      - type: mongo_mgr_connect_mondo_config
        target: mongo_config
      - type: mongo_mgr_connect_mondos
        target: mongos


#output:
#  mongo_clouster_info:
#    description: Mongo Clouster Info
#    value:
#      config_servers: { get_attribute: [] }
#      shard_servers: { get_attribute: [] }
#      primery_servers: { get_attribute: [] }
